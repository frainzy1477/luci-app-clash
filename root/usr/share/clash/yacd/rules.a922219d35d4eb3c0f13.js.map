{"version":3,"sources":["webpack://yacd/./src/api/rule-provider.ts","webpack://yacd/./src/api/rules.ts","webpack://yacd/./src/store/rules.ts","webpack://yacd/./src/components/rules/rules.hooks.tsx","webpack://yacd/./src/components/rules/RuleProviderItem.module.css?1b8d","webpack://yacd/./src/components/rules/RuleProviderItem.tsx","webpack://yacd/./src/components/rules/RulesPageFab.tsx","webpack://yacd/./src/components/rules/TextFilter.tsx","webpack://yacd/./src/components/Rule.module.css?b5ee","webpack://yacd/./src/components/Rule.tsx","webpack://yacd/./src/components/Rules.module.css?cfcc","webpack://yacd/./src/components/Rules.tsx","webpack://yacd/./src/components/shared/Fab.module.css?1ffc","webpack://yacd/./src/components/shared/Fab.tsx","webpack://yacd/./src/components/shared/RotateIcon.module.css?428b","webpack://yacd/./src/components/shared/RotateIcon.tsx","webpack://yacd/./src/hooks/useRemainingViewPortHeight.ts","webpack://yacd/./src/hooks/useTextInput.ts","webpack://yacd/./node_modules/invariant/browser.js","webpack://yacd/./src/components/shared.module.css?fc9f","webpack://yacd/./node_modules/react-feather/dist/icons/rotate-cw.js"],"names":["normalizeAPIResponse","data","providers","names","Object","keys","byName","i","length","name","idx","endpoint","apiConfig","getURLAndInit","url","init","fetch","res","ok","json","console","log","refreshRuleProviderByName","method","updateRuleProviders","invariant","rules","map","r","id","ruleFilterText","atom","key","default","React","useRuleProviderQuery","useQuery","fetchRuleProviders","useRuleAndProvider","fetchRules","isFetching","provider","useRecoilState","filterText","f","toLowerCase","filter","payload","indexOf","t","RuleProviderItem","vehicleType","behavior","updatedAt","ruleCount","queryClient","useQueryClient","useMutation","onSuccess","invalidateQueries","mutate","ev","preventDefault","isLoading","useUpdateRuleProviderItem","onClickRefreshButton","isRefreshing","timeAgo","formatDistance","Date","className","s","type","Button","onClick","disabled","RotateIcon","isRotating","RulesPageFab","useUpdateAllRuleProviderItems","update","useTranslation","Fab","icon","text","style","fabPosition","TextFilter","useTextInut","onChange","shared","value","placeholder","colorMap","_default","DIRECT","REJECT","proxy","styleProxy","color","getStyleFor","s0","memo","itemKey","index","providerQty","Row","item","areEqual","connect","getClashAPIConfig","useRemainingViewPortHeight","refRulesContainer","containerHeight","getItemSize","getItemSizeFactory","ContentHeader","title","ref","paddingBottom","height","width","itemCount","itemSize","itemData","IsFetching","children","position","right","bottom","cls","cx","useState","useRef","useCallback","useLayoutEffect","setContainerHeight","updateContainerHeight","top","current","getBoundingClientRect","window","innerHeight","addEventListener","removeEventListener","useMemo","x","setTextGlobal","setText","setTextDebounced","debounce","e","target","module","exports","condition","format","a","b","c","d","error","undefined","Error","args","argIndex","replace","framesToPop","_extends","assign","arguments","source","prototype","hasOwnProperty","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","RotateCw","forwardRef","_ref","_ref$color","_ref$size","size","rest","xmlns","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","points","propTypes","displayName"],"mappings":"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","file":"rules.a922219d35d4eb3c0f13.js","sourcesContent":["import { getURLAndInit } from 'src/misc/request-helper';\nimport { ClashAPIConfig } from 'src/types';\n\nexport type RuleProvider = RuleProviderAPIItem & { idx: number };\n\nexport type RuleProviderAPIItem = {\n  behavior: string;\n  name: string;\n  ruleCount: number;\n  type: 'Rule';\n  // example value \"2020-06-30T16:23:01.44143802+08:00\"\n  updatedAt: string;\n  vehicleType: 'HTTP' | 'File';\n};\n\ntype RuleProviderAPIData = {\n  providers: Record<string, RuleProviderAPIItem>;\n};\n\nfunction normalizeAPIResponse(data: RuleProviderAPIData) {\n  const providers = data.providers;\n  const names = Object.keys(providers);\n  const byName: Record<string, RuleProvider> = {};\n\n  // attach an idx to each item\n  for (let i = 0; i < names.length; i++) {\n    const name = names[i];\n    byName[name] = { ...providers[name], idx: i };\n  }\n\n  return { byName, names };\n}\n\nexport async function fetchRuleProviders(\n  endpoint: string,\n  apiConfig: ClashAPIConfig\n) {\n  const { url, init } = getURLAndInit(apiConfig);\n\n  let data = { providers: {} };\n  try {\n    const res = await fetch(url + endpoint, init);\n    if (res.ok) {\n      data = await res.json();\n    }\n  } catch (err) {\n    // log and ignore\n    // eslint-disable-next-line no-console\n    console.log('failed to GET /providers/rules', err);\n  }\n  return normalizeAPIResponse(data);\n}\n\nexport async function refreshRuleProviderByName({\n  name,\n  apiConfig,\n}: {\n  name: string;\n  apiConfig: ClashAPIConfig;\n}) {\n  const { url, init } = getURLAndInit(apiConfig);\n  try {\n    const res = await fetch(url + `/providers/rules/${name}`, {\n      method: 'PUT',\n      ...init,\n    });\n    return res.ok;\n  } catch (err) {\n    // log and ignore\n    // eslint-disable-next-line no-console\n    console.log('failed to PUT /providers/rules/:name', err);\n    return false;\n  }\n}\n\nexport async function updateRuleProviders({\n  names,\n  apiConfig,\n}: {\n  names: string[];\n  apiConfig: ClashAPIConfig;\n}) {\n  for (let i = 0; i < names.length; i++) {\n    // run in sequence\n    await refreshRuleProviderByName({ name: names[i], apiConfig });\n  }\n}\n","import invariant from 'invariant';\nimport { getURLAndInit } from 'src/misc/request-helper';\nimport { ClashAPIConfig } from 'src/types';\n\n// const endpoint = '/rules';\n\ntype RuleItem = RuleAPIItem & { id: number };\n\ntype RuleAPIItem = {\n  type: string;\n  payload: string;\n  proxy: string;\n};\n\nfunction normalizeAPIResponse(json: {\n  rules: Array<RuleAPIItem>;\n}): Array<RuleItem> {\n  invariant(\n    json.rules && json.rules.length >= 0,\n    'there is no valid rules list in the rules API response'\n  );\n\n  // attach an id\n  return json.rules.map((r: RuleAPIItem, i: number) => ({ ...r, id: i }));\n}\n\nexport async function fetchRules(endpoint: string, apiConfig: ClashAPIConfig) {\n  let json = { rules: [] };\n  try {\n    const { url, init } = getURLAndInit(apiConfig);\n    const res = await fetch(url + endpoint, init);\n    if (res.ok) {\n      json = await res.json();\n    }\n  } catch (err) {\n    // log and ignore\n    // eslint-disable-next-line no-console\n    console.log('failed to fetch rules', err);\n  }\n  return normalizeAPIResponse(json);\n}\n","import { atom } from 'recoil';\n\nexport const ruleFilterText = atom({\n  key: 'ruleFilterText',\n  default: '',\n});\n","import * as React from 'react';\nimport { useMutation, useQuery, useQueryClient } from 'react-query';\nimport { useRecoilState } from 'recoil';\nimport {\n  fetchRuleProviders,\n  refreshRuleProviderByName,\n  updateRuleProviders,\n} from 'src/api/rule-provider';\nimport { fetchRules } from 'src/api/rules';\nimport { ruleFilterText } from 'src/store/rules';\nimport type { ClashAPIConfig } from 'src/types';\n\nconst { useCallback } = React;\n\nexport function useUpdateRuleProviderItem(\n  name: string,\n  apiConfig: ClashAPIConfig\n): [(ev: React.MouseEvent<HTMLButtonElement>) => unknown, boolean] {\n  const queryClient = useQueryClient();\n  const { mutate, isLoading } = useMutation(refreshRuleProviderByName, {\n    onSuccess: () => {\n      queryClient.invalidateQueries('/providers/rules');\n    },\n  });\n  const onClickRefreshButton = (ev: React.MouseEvent<HTMLButtonElement>) => {\n    ev.preventDefault();\n    mutate({ name, apiConfig });\n  };\n  return [onClickRefreshButton, isLoading];\n}\n\nexport function useUpdateAllRuleProviderItems(\n  apiConfig: ClashAPIConfig\n): [(ev: React.MouseEvent<HTMLButtonElement>) => unknown, boolean] {\n  const queryClient = useQueryClient();\n  const { data: provider } = useRuleProviderQuery(apiConfig);\n  const { mutate, isLoading } = useMutation(updateRuleProviders, {\n    onSuccess: () => {\n      queryClient.invalidateQueries('/providers/rules');\n    },\n  });\n  const onClickRefreshButton = (ev: React.MouseEvent<HTMLButtonElement>) => {\n    ev.preventDefault();\n    mutate({ names: provider.names, apiConfig });\n  };\n  return [onClickRefreshButton, isLoading];\n}\n\nexport function useInvalidateQueries() {\n  const queryClient = useQueryClient();\n  return useCallback(() => {\n    queryClient.invalidateQueries('/rules');\n    queryClient.invalidateQueries('/providers/rules');\n  }, [queryClient]);\n}\n\nexport function useRuleProviderQuery(apiConfig: ClashAPIConfig) {\n  return useQuery(['/providers/rules', apiConfig], () =>\n    fetchRuleProviders('/providers/rules', apiConfig)\n  );\n}\n\nexport function useRuleAndProvider(apiConfig: ClashAPIConfig) {\n  const { data: rules, isFetching } = useQuery(['/rules', apiConfig], () =>\n    fetchRules('/rules', apiConfig)\n  );\n  const { data: provider } = useRuleProviderQuery(apiConfig);\n\n  const [filterText] = useRecoilState(ruleFilterText);\n  if (filterText === '') {\n    return { rules, provider, isFetching };\n  } else {\n    const f = filterText.toLowerCase();\n    return {\n      rules: rules.filter((r) => r.payload.toLowerCase().indexOf(f) >= 0),\n      isFetching,\n      provider: {\n        byName: provider.byName,\n        names: provider.names.filter((t) => t.toLowerCase().indexOf(f) >= 0),\n      },\n    };\n  }\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"RuleProviderItem\":\"_2F14Vs-eyF\",\"left\":\"x4HgsJSs_L\",\"middle\":\"_1AQt0kcvQz\",\"gray\":\"_28wqsVo1h2\",\"refreshButtonWrapper\":\"_1g-irMIYO_\"};","import { formatDistance } from 'date-fns';\nimport * as React from 'react';\nimport Button from 'src/components/Button';\nimport { useUpdateRuleProviderItem } from 'src/components/rules/rules.hooks';\nimport { SectionNameType } from 'src/components/shared/Basic';\nimport { RotateIcon } from 'src/components/shared/RotateIcon';\n\nimport s from './RuleProviderItem.module.css';\n\nexport function RuleProviderItem({\n  idx,\n  name,\n  vehicleType,\n  behavior,\n  updatedAt,\n  ruleCount,\n  apiConfig,\n}) {\n  const [onClickRefreshButton, isRefreshing] = useUpdateRuleProviderItem(\n    name,\n    apiConfig\n  );\n  const timeAgo = formatDistance(new Date(updatedAt), new Date());\n  return (\n    <div className={s.RuleProviderItem}>\n      <span className={s.left}>{idx}</span>\n      <div className={s.middle}>\n        <SectionNameType name={name} type={`${vehicleType} / ${behavior}`} />\n        <div className={s.gray}>\n          {ruleCount < 2 ? `${ruleCount} rule` : `${ruleCount} rules`}\n        </div>\n        <small className={s.gray}>Updated {timeAgo} ago</small>\n      </div>\n      <span className={s.refreshButtonWrapper}>\n        <Button onClick={onClickRefreshButton} disabled={isRefreshing}>\n          <RotateIcon isRotating={isRefreshing} />\n        </Button>\n      </span>\n    </div>\n  );\n}\n","import * as React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useUpdateAllRuleProviderItems } from 'src/components/rules/rules.hooks';\nimport { Fab, position as fabPosition } from 'src/components/shared/Fab';\nimport { RotateIcon } from 'src/components/shared/RotateIcon';\nimport { ClashAPIConfig } from 'src/types';\n\ntype RulesPageFabProps = {\n  apiConfig: ClashAPIConfig;\n};\n\nexport function RulesPageFab({ apiConfig }: RulesPageFabProps) {\n  const [update, isLoading] = useUpdateAllRuleProviderItems(apiConfig);\n  const { t } = useTranslation();\n  return (\n    <Fab\n      icon={<RotateIcon isRotating={isLoading} />}\n      text={t('update_all_rule_provider')}\n      style={fabPosition}\n      onClick={update}\n    />\n  );\n}\n","import * as React from 'react';\nimport { useTextInut } from 'src/hooks/useTextInput';\nimport { ruleFilterText } from 'src/store/rules';\n\nimport shared from '../shared.module.css';\n\nexport function TextFilter() {\n  const [onChange, text] = useTextInut(ruleFilterText);\n  return (\n    <input\n      className={shared.input}\n      type=\"text\"\n      value={text}\n      onChange={onChange}\n      placeholder=\"Filter\"\n    />\n  );\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"rule\":\"_2ZxnpAgEbI\",\"left\":\"_1Waxn5PO-y\",\"a\":\"_1YW1imuuRW\",\"b\":\"_3Anv9Ytzq4\",\"type\":\"_28txnmlSD3\"};","import React from 'react';\n\nimport s0 from './Rule.module.css';\n\nconst colorMap = {\n  _default: '#59caf9',\n  DIRECT: '#f5bc41',\n  REJECT: '#cb3166',\n};\n\nfunction getStyleFor({ proxy }) {\n  let color = colorMap._default;\n  if (colorMap[proxy]) {\n    color = colorMap[proxy];\n  }\n  return { color };\n}\n\ntype Props = {\n  id?: number;\n  type?: string;\n  payload?: string;\n  proxy?: string;\n};\n\nfunction Rule({ type, payload, proxy, id }: Props) {\n  const styleProxy = getStyleFor({ proxy });\n  return (\n    <div className={s0.rule}>\n      <div className={s0.left}>{id}</div>\n      <div>\n        <div className={s0.b}>{payload}</div>\n        <div className={s0.a}>\n          <div className={s0.type}>{type}</div>\n          <div style={styleProxy}>{proxy}</div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default Rule;\n","// extracted by mini-css-extract-plugin\nexport default {\"header\":\"_3WrcX9K2WQ\",\"RuleProviderItemWrapper\":\"_109LiAqCt-\"};","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { areEqual, VariableSizeList } from 'react-window';\nimport { RuleProviderItem } from 'src/components/rules/RuleProviderItem';\nimport { useRuleAndProvider } from 'src/components/rules/rules.hooks';\nimport { RulesPageFab } from 'src/components/rules/RulesPageFab';\nimport { TextFilter } from 'src/components/rules/TextFilter';\nimport { State } from 'src/store/types';\nimport { ClashAPIConfig } from 'src/types';\n\nimport useRemainingViewPortHeight from '../hooks/useRemainingViewPortHeight';\nimport { getClashAPIConfig } from '../store/app';\nimport ContentHeader from './ContentHeader';\nimport Rule from './Rule';\nimport s from './Rules.module.css';\nimport { connect } from './StateProvider';\n\nconst { memo } = React;\n\nconst paddingBottom = 30;\n\nfunction itemKey(index: number, { rules, provider }) {\n  const providerQty = provider.names.length;\n\n  if (index < providerQty) {\n    return provider.names[index];\n  }\n  const item = rules[index - providerQty];\n  return item.id;\n}\n\nfunction getItemSizeFactory({ provider }) {\n  return function getItemSize(idx: number) {\n    const providerQty = provider.names.length;\n    if (idx < providerQty) {\n      // provider\n      return 90;\n    }\n    // rule\n    return 80;\n  };\n}\n\n// @ts-expect-error ts-migrate(2339) FIXME: Property 'index' does not exist on type '{ childre... Remove this comment to see the full error message\nconst Row = memo(({ index, style, data }) => {\n  const { rules, provider, apiConfig } = data;\n  const providerQty = provider.names.length;\n\n  if (index < providerQty) {\n    const name = provider.names[index];\n    const item = provider.byName[name];\n    return (\n      <div style={style} className={s.RuleProviderItemWrapper}>\n        <RuleProviderItem apiConfig={apiConfig} {...item} />\n      </div>\n    );\n  }\n\n  const r = rules[index - providerQty];\n  return (\n    <div style={style}>\n      <Rule {...r} />\n    </div>\n  );\n}, areEqual);\n\nconst mapState = (s: State) => ({\n  apiConfig: getClashAPIConfig(s),\n});\n\nexport default connect(mapState)(Rules);\n\ntype RulesProps = {\n  apiConfig: ClashAPIConfig;\n};\n\nfunction Rules({ apiConfig }: RulesProps) {\n  const [refRulesContainer, containerHeight] = useRemainingViewPortHeight();\n  const { rules, provider } = useRuleAndProvider(apiConfig);\n  const getItemSize = getItemSizeFactory({ provider });\n\n  const { t } = useTranslation();\n\n  return (\n    <div>\n      <div className={s.header}>\n        <ContentHeader title={t('Rules')} />\n        <TextFilter />\n      </div>\n      {/* @ts-expect-error ts-migrate(2322) FIXME: Type 'number | MutableRefObject<any>' is not assig... Remove this comment to see the full error message */}\n      <div ref={refRulesContainer} style={{ paddingBottom }}>\n        <VariableSizeList\n          // @ts-expect-error ts-migrate(2362) FIXME: The left-hand side of an arithmetic operation must... Remove this comment to see the full error message\n          height={containerHeight - paddingBottom}\n          width=\"100%\"\n          itemCount={rules.length + provider.names.length}\n          itemSize={getItemSize}\n          itemData={{ rules, provider, apiConfig }}\n          itemKey={itemKey}\n        >\n          {Row}\n        </VariableSizeList>\n      </div>\n      {provider && provider.names && provider.names.length > 0 ? (\n        <RulesPageFab apiConfig={apiConfig} />\n      ) : null}\n    </div>\n  );\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"spining\":\"_3nmqcBZJL5\",\"spining_keyframes\":\"RLtvWZ8oZ2\"};","import './rtf.css';\n\nimport * as React from 'react';\nimport { Action, Fab } from 'react-tiny-fab/dist';\n\nimport s from './Fab.module.css';\n\nexport function IsFetching({ children }: { children: React.ReactNode }) {\n  return <span className={s.spining}>{children}</span>;\n}\n\nexport const position = {\n  right: 10,\n  bottom: 10,\n};\n\nexport { Fab, Action };\n","// extracted by mini-css-extract-plugin\nexport default {\"rotate\":\"_3UD6wCqqgE\",\"isRotating\":\"W4xtnaGef4\",\"rotating\":\"_3A1z9z4LFT\"};","import cx from 'clsx';\nimport * as React from 'react';\nimport { RotateCw } from 'react-feather';\n\nimport s from './RotateIcon.module.css';\n\nexport function RotateIcon({ isRotating }: { isRotating: boolean }) {\n  const cls = cx(s.rotate, {\n    [s.isRotating]: isRotating,\n  });\n  return (\n    <span className={cls}>\n      <RotateCw width={16} />\n    </span>\n  );\n}\n","import React from 'react';\n\nconst { useState, useRef, useCallback, useLayoutEffect } = React;\n\n/**\n * cosnt [ref, remainingHeight] = useRemainingViewPortHeight();\n *\n * return a reference, and the remaining height of the referenced dom node\n * to the bottom of the view port\n *\n */\nexport default function useRemainingViewPortHeight() {\n  const ref = useRef(null);\n  const [containerHeight, setContainerHeight] = useState(200);\n  const updateContainerHeight = useCallback(() => {\n    const { top } = ref.current.getBoundingClientRect();\n    setContainerHeight(window.innerHeight - top);\n  }, []);\n\n  useLayoutEffect(() => {\n    updateContainerHeight();\n    window.addEventListener('resize', updateContainerHeight);\n    return () => {\n      window.removeEventListener('resize', updateContainerHeight);\n    };\n  }, [updateContainerHeight]);\n\n  return [ref, containerHeight];\n}\n","import debounce from 'lodash-es/debounce';\nimport * as React from 'react';\nimport { RecoilState, useRecoilState } from 'recoil';\n\nconst { useCallback, useState, useMemo } = React;\n\nexport function useTextInut(\n  x: RecoilState<string>\n): [(e: React.ChangeEvent<HTMLInputElement>) => void, string] {\n  const [, setTextGlobal] = useRecoilState(x);\n  const [text, setText] = useState('');\n  const setTextDebounced = useMemo(() => debounce(setTextGlobal, 300), [\n    setTextGlobal,\n  ]);\n  const onChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setText(e.target.value);\n      setTextDebounced(e.target.value);\n    },\n    [setTextDebounced]\n  );\n  return [onChange, text];\n}\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\n/**\n * Use invariant() to assert state which your program assumes to be true.\n *\n * Provide sprintf-style format (only %s is supported) and arguments\n * to provide information about what broke and what you were\n * expecting.\n *\n * The invariant message will be stripped in production, but the invariant\n * will remain to ensure logic does not differ in production.\n */\n\nvar invariant = function(condition, format, a, b, c, d, e, f) {\n  if (process.env.NODE_ENV !== 'production') {\n    if (format === undefined) {\n      throw new Error('invariant requires an error message argument');\n    }\n  }\n\n  if (!condition) {\n    var error;\n    if (format === undefined) {\n      error = new Error(\n        'Minified exception occurred; use the non-minified dev environment ' +\n        'for the full error message and additional helpful warnings.'\n      );\n    } else {\n      var args = [a, b, c, d, e, f];\n      var argIndex = 0;\n      error = new Error(\n        format.replace(/%s/g, function() { return args[argIndex++]; })\n      );\n      error.name = 'Invariant Violation';\n    }\n\n    error.framesToPop = 1; // we don't care about invariant's own frame\n    throw error;\n  }\n};\n\nmodule.exports = invariant;\n","// extracted by mini-css-extract-plugin\nexport default {\"input\":\"_1I0EXOg8Vu\"};","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React, { forwardRef } from 'react';\nimport PropTypes from 'prop-types';\nvar RotateCw = forwardRef(function (_ref, ref) {\n  var _ref$color = _ref.color,\n      color = _ref$color === void 0 ? 'currentColor' : _ref$color,\n      _ref$size = _ref.size,\n      size = _ref$size === void 0 ? 24 : _ref$size,\n      rest = _objectWithoutProperties(_ref, [\"color\", \"size\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    ref: ref,\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: size,\n    height: size,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: color,\n    strokeWidth: \"2\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  }, rest), /*#__PURE__*/React.createElement(\"polyline\", {\n    points: \"23 4 23 10 17 10\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"\n  }));\n});\nRotateCw.propTypes = {\n  color: PropTypes.string,\n  size: PropTypes.oneOfType([PropTypes.string, PropTypes.number])\n};\nRotateCw.displayName = 'RotateCw';\nexport default RotateCw;"],"sourceRoot":""}